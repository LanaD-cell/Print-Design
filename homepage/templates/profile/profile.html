{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4 profile-container">
  <div class="row">
    <!-- Profile Card -->
    <div class="col-md-6">
      <div class="profile-card">
        <div class="profile-card-header">
          <h2 class="mb-4">
            Welcome,
            {% if request.user.first_name %}
              {{ request.user.first_name }}
            {% else %}
              {{ request.user.username }}
            {% endif %}
          </h2>
        </div>
        <div class="profile-card-body">
          <h4>Current Orders</h4>
          {% if current_orders %}
            <ul class="list-group">
              {% for order in current_orders %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  {% if order.session_id %}
                    <a href="{% url 'cart:order_detail' order.order_number %}">
                      Order #{{ order.order_number }} – {{ order.created_at|date:"M d, Y" }}
                    </a>
                  {% else %}
                    <span>
                      Order #{{ order.order_number }} – {{ order.created_at|date:"M d, Y" }}
                    </span>
                  {% endif %}
                  <span class="status-badge
                      {% if order.status == 'Pending' %} badge-pending
                      {% elif order.status == 'Processing' %} badge-processing
                      {% endif %}
                  ">
                      {{ order.status }}
                  </span>

                  <div class="order-items mt-3">
                    {% for line_item in order.line_items.all %}
                      <div class="cart-card mb-3">
                        <div class="row no-gutters">
                          <div class="col-md-4">
                            {% if line_item.product.image_url %}
                              <img src="{{ line_item.product.image_url }}" alt="{{ line_item.product.name }}" class="card-img" style="width: 100%; height: auto;">
                            {% else %}
                              <img src="{{ MEDIA_URL }}noimage.png" alt="{{ line_item.product.name }}" class="card-img" style="width: 100%; height: auto;">
                            {% endif %}
                          </div>
                          <div class="col-md-8">
                            <div class="cart-card-body">
                              <h5 class="cart-card-title">{{ line_item.product.name }}</h5>
                              <p class="cart-card-text"><strong>Size:</strong> {{ line_item.product_size }}</p>
                              <p class="cart-card-text"><strong>Quantity:</strong> {{ line_item.quantity }}</p>
                              <p class="cart-card-text"><strong>Price:</strong> €{{ line_item.product.price }}</p>
                              <p class="cart-card-text"><strong>Service Cost:</strong> €{{ line_item.service_price }}</p>
                              <p class="cart-card-text"><strong>Total:</strong> €{{ line_item.lineitem_total }}</p>
                            </div>
                          </div>
                        </div>
                      </div>
                    {% endfor %}
                  </div>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">No current orders.</p>
          {% endif %}

          <h4>Previous Orders</h4>
          {% if previous_orders %}
            <ul class="list-group">
              {% for order in previous_orders %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  {% if order.session_id %}
                    <a href="{% url 'cart:order_detail' order.order_number %}">
                      Order #{{ order.order_number }} – {{ order.created_at|date:"M d, Y" }}
                    </a>
                  {% else %}
                    <span>
                      Order #{{ order.order_number }} – {{ order.created_at|date:"M d, Y" }}
                    </span>
                  {% endif %}
                  <span class="badge
                    {% if order.status == 'Delivered' %} bg-success
                    {% elif order.status == 'Cancelled' %} bg-danger
                    {% endif %}"
                    style="color: {% if order.status == 'Delivered' %} #28b463
                          {% elif order.status == 'Cancelled' %} #c0392b
                          {% endif %};">
                    {{ order.status }}
                  </span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">No previous orders yet.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Mascot -->
    <div class="col-md-6">
      <div class="profile-mascot text-center">
        <img src="/static/images/welcome-home-robot.webp" alt="Mascot" class="img-fluid">
      </div>
    </div>
  </div>
</div>
{% endblock %}
